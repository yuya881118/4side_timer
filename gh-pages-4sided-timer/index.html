<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover">
<title>4-Sided Timer – Front Oriented</title>
<style>
  :root{ --bg:#000; --fg:#fff; --accent:#00d1b2; --danger:#ff3860; --muted:#888; }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
  .app{display:flex;flex-direction:column;height:100dvh;gap:1rem;padding:1rem;}
  .grid{position:relative;flex:1;border-radius:1rem;overflow:hidden;border:2px solid #222;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.03));}
  .display{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-variant-numeric:tabular-nums;letter-spacing:0.02em;
           font-weight:700;text-shadow:0 0 18px rgba(255,255,255,0.06);user-select:none;pointer-events:none;white-space:nowrap;}
  .display span{display:inline-block;font-size: min(20vw, 18vh); line-height:1;}
  .d-front{top:92%; left:50%; transform:translate(-50%,-100%) rotate(0deg);}     /* front (user side) */
  .d-top{top:8%; left:50%; transform:translate(-50%,0) rotate(180deg);}          /* opposite side */
  .d-left{top:50%; left:8%; transform:translate(-50%,-50%) rotate(90deg);}       /* left side */
  .d-right{top:50%; left:92%; transform:translate(-50%,-50%) rotate(270deg);}    /* right side */
  .controls{display:flex;flex-wrap:wrap;gap:.6rem;align-items:center;justify-content:center}
  .group{display:flex;gap:.4rem;flex-wrap:wrap;align-items:center}
  input[type="number"]{width:4.4rem;background:#111;border:1px solid #333;border-radius:.6rem;color:var(--fg);
                       padding:.6rem;font-size:1.1rem;text-align:center;appearance:textfield}
  input[type="number"]::-webkit-outer-spin-button,input[type="number"]::-webkit-inner-spin-button{appearance:none;margin:0}
  button{background:#111;border:1px solid #333;color:var(--fg);padding:.65rem .9rem;border-radius:.7rem;font-size:1rem;
         cursor:pointer;touch-action:manipulation}
  button:active{transform:translateY(1px)}
  .primary{border-color:var(--accent)}
  .danger{border-color:var(--danger);}
  .chip{font-variant-numeric:tabular-nums;background:#0d0d0d;border:1px dashed #333}
  .pill{border-radius:999px;padding:.45rem .8rem}
  .toggle{border-color:#555}
  .on{box-shadow:0 0 0 2px var(--accent) inset}
  .hint{color:var(--muted);font-size:.85rem;text-align:center}
  @media (orientation:portrait){
    .display span{font-size: min(18vw, 16vh);}
    .d-top{top:9%}
    .d-front{top:91%}
    .d-left{left:9%}
    .d-right{left:91%}
  }
</style>
</head>
<body>
<div class="app">
  <div class="grid" id="stage" aria-live="polite">
    <div class="display d-top"><span id="t0">00:00</span></div>
    <div class="display d-right"><span id="t1">00:00</span></div>
    <div class="display d-front"><span id="t2">00:00</span></div>
    <div class="display d-left"><span id="t3">00:00</span></div>
  </div>

  <div class="controls">
    <div class="group">
      <label for="min" class="hint">分</label>
      <input id="min" type="number" min="0" max="999" value="0" inputmode="numeric">
      <label for="sec" class="hint">秒</label>
      <input id="sec" type="number" min="0" max="59" value="30" inputmode="numeric">
    </div>
    <div class="group">
      <button class="chip pill" data-add="10">+10s</button>
      <button class="chip pill" data-add="30">+30s</button>
      <button class="chip pill" data-add="60">+1m</button>
      <button class="chip pill" data-add="300">+5m</button>
    </div>
    <div class="group">
      <button id="start" class="primary">スタート</button>
      <button id="pause">一時停止</button>
      <button id="reset" class="danger">リセット</button>
    </div>
    <div class="group">
      <button id="full" class="toggle">フルスクリーン</button>
      <button id="invert" class="toggle">白背景/黒文字</button>
      <button id="wakelock" class="toggle">画面を暗くしない</button>
      <button id="beepBtn" class="toggle on">音あり</button>
    </div>
  </div>
  <div class="hint">iPadを中央に置き、四方から正位置表示。手前（下側）が基準です。</div>
</div>

<script>
(() => {
  const s = (id) => document.getElementById(id);
  const tEls = [s('t0'), s('t1'), s('t2'), s('t3')];
  const minI = s('min');
  const secI = s('sec');
  const startB = s('start');
  const pauseB = s('pause');
  const resetB = s('reset');
  const fullB = s('full');
  const invertB = s('invert');
  const wakelockB = s('wakelock');
  const beepB = s('beepBtn');
  const stage = s('stage');

  let remainingMs = 30_000;
  let timerId = null;
  let endTime = null;
  let wakeLock = null;
  let audioCtx = null;
  let beepEnabled = true;

  function fmt(ms){
    if(ms < 0) ms = 0;
    const totalSec = Math.floor(ms/1000);
    const h = Math.floor(totalSec / 3600);
    const m = Math.floor((totalSec % 3600) / 60);
    const s = totalSec % 60;
    return h > 0 ? `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`
                 : `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }
  function render(){ const text = fmt(remainingMs); tEls.forEach(el => el.textContent = text); document.title = text + " – 4-Sided Timer"; }
  function setFromInputs(){ const m = Math.max(0, Math.min(999, parseInt(minI.value || "0", 10))); const s = Math.max(0, Math.min(59, parseInt(secI.value || "0", 10))); remainingMs = (m*60 + s) * 1000; render(); }
  function start(){ if(timerId) return; setFromInputs(); endTime = Date.now() + remainingMs; timerId = setInterval(tick, 100); startB.disabled = true; }
  function tick(){ remainingMs = endTime - Date.now(); if(remainingMs <= 0){ remainingMs = 0; render(); stopInterval(); onFinish(); return; } render(); }
  function pause(){ if(!timerId) return; remainingMs = Math.max(0, endTime - Date.now()); stopInterval(); render(); }
  function reset(){ stopInterval(); setFromInputs(); startB.disabled = false; }
  function stopInterval(){ clearInterval(timerId); timerId = null; startB.disabled = false; }
  function addSeconds(sec){ if(timerId){ endTime += sec*1000; }else{ remainingMs = Math.max(0, remainingMs + sec*1000); const total = Math.floor(remainingMs/1000); minI.value = Math.floor(total/60); secI.value = total%60; render(); } }
  function onFinish(){ if(beepEnabled){ beep(); } stage.animate([{filter:'brightness(1)'},{filter:'brightness(2)'},{filter:'brightness(1)'}], {duration:600, iterations:2}); }
  function beep(){ try{ if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type='sine'; o.frequency.setValueAtTime(880, audioCtx.currentTime); g.gain.setValueAtTime(0.0001, audioCtx.currentTime); o.connect(g).connect(audioCtx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime+0.01); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.4); setTimeout(()=>o.stop(), 450); setTimeout(()=>beepSingle(1320, 220), 180); setTimeout(()=>beepSingle(1760, 220), 360);}catch(e){} }
  function beepSingle(freq, dur){ if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type='sine'; o.frequency.setValueAtTime(freq, audioCtx.currentTime); g.gain.setValueAtTime(0.0001, audioCtx.currentTime); o.connect(g).connect(audioCtx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.18, audioCtx.currentTime+0.01); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+dur/1000); setTimeout(()=>o.stop(), dur); }
  async function toggleFullscreen(){ try{ if(!document.fullscreenElement){ await document.documentElement.requestFullscreen(); fullB.classList.add('on'); }else{ await document.exitFullscreen(); fullB.classList.remove('on'); } }catch(e){} }
  invertB.addEventListener('click', () => { const isLight = document.body.dataset.theme === 'light'; if(isLight){ document.body.dataset.theme = ''; document.documentElement.style.setProperty('--bg', '#000'); document.documentElement.style.setProperty('--fg', '#fff'); }else{ document.body.dataset.theme = 'light'; document.documentElement.style.setProperty('--bg', '#fff'); document.documentElement.style.setProperty('--fg', '#000'); } invertB.classList.toggle('on'); });
  async function requestWakeLock(){ if('wakeLock' in navigator){ try{ wakeLock = await navigator.wakeLock.request('screen'); wakelockB.classList.add('on'); wakeLock.addEventListener('release', () => { wakelockB.classList.remove('on'); }); }catch(e){} }else{ alert('お使いのブラウザはWake Lock APIに未対応の可能性があります。画面の自動ロックをオフにしてください。'); } }
  async function toggleWakeLock(){ if(wakeLock){ try{ await wakeLock.release(); }catch(e){} wakeLock = null; wakelockB.classList.remove('on'); }else{ requestWakeLock(); } }
  document.querySelectorAll('[data-add]').forEach(btn => { btn.addEventListener('click', () => addSeconds(parseInt(btn.dataset.add,10))); });
  startB.addEventListener('click', start);
  pauseB.addEventListener('click', pause);
  resetB.addEventListener('click', reset);
  fullB.addEventListener('click', toggleFullscreen);
  wakelockB.addEventListener('click', toggleWakeLock);
  beepB.addEventListener('click', () => { beepEnabled = !beepEnabled; beepB.classList.toggle('on', beepEnabled); });
  minI.addEventListener('change', setFromInputs);
  secI.addEventListener('change', setFromInputs);
  setFromInputs(); render();
  window.addEventListener('touchstart', () => { if(!audioCtx){ try{ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }catch(e){} } }, { once:true });
})();
</script>
</body>
</html>
